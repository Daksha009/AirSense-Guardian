<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirSense Guardian - Visual Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/viz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/full.render.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #e0e0e0;
        }
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        .content {
            padding: 40px;
            min-height: 600px;
        }
        .diagram-container {
            background: #fafafa;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .diagram-container svg {
            max-width: 100%;
            height: auto;
        }
        .description {
            margin-top: 30px;
            padding: 20px;
            background: #e8f4f8;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        .description h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .description ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        .loading {
            color: #666;
            font-size: 1.2em;
        }
        .error {
            color: #e74c3c;
            padding: 20px;
            background: #ffe6e6;
            border-radius: 4px;
        }
        .download-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .download-btn:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š AirSense Guardian</h1>
            <p>Visual Diagram Viewer</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab(0)">Confusion Matrix</button>
            <button class="tab" onclick="showTab(1)">Deployment Pipeline</button>
            <button class="tab" onclick="showTab(2)">System Flowchart</button>
        </div>
        
        <div class="content">
            <div id="tab-0" class="tab-content">
                <div class="diagram-container" id="diagram-0">
                    <div class="loading">Loading diagram...</div>
                </div>
                <div class="description">
                    <h3>ðŸ“ˆ Confusion Matrix - AQI Prediction Accuracy</h3>
                    <ul>
                        <li><strong>RÂ² Score:</strong> 0.733 (73.3% variance explained)</li>
                        <li><strong>RMSE:</strong> 10.56 AQI points</li>
                        <li><strong>MAE:</strong> 8.39 AQI points</li>
                        <li><strong>MAPE:</strong> 8.82%</li>
                        <li>Shows prediction accuracy by AQI category (Good, Moderate, Unhealthy, etc.)</li>
                        <li>Displays True Positive rates and overall model performance</li>
                    </ul>
                </div>
            </div>
            
            <div id="tab-1" class="tab-content" style="display:none;">
                <div class="diagram-container" id="diagram-1">
                    <div class="loading">Loading diagram...</div>
                </div>
                <div class="description">
                    <h3>ðŸš€ Model Deployment Pipeline</h3>
                    <ul>
                        <li><strong>Stage 1:</strong> Data Collection (OpenAQ, OpenWeatherMap APIs)</li>
                        <li><strong>Stage 2:</strong> Model Training (Feature Engineering, Hyperparameter Tuning)</li>
                        <li><strong>Stage 3:</strong> Model Persistence (Save model and metadata)</li>
                        <li><strong>Stage 4:</strong> Model Deployment (Flask API with endpoints)</li>
                        <li><strong>Stage 5:</strong> Production (React Frontend integration)</li>
                        <li><strong>Stage 6:</strong> Monitoring & Updates (Performance tracking, retraining)</li>
                    </ul>
                </div>
            </div>
            
            <div id="tab-2" class="tab-content" style="display:none;">
                <div class="diagram-container" id="diagram-2">
                    <div class="loading">Loading diagram...</div>
                </div>
                <div class="description">
                    <h3>ðŸ”„ System Flowchart - Complete Architecture</h3>
                    <ul>
                        <li>User journey from React Frontend to Flask Backend</li>
                        <li>Data flow: API requests â†’ ML models â†’ JSON responses</li>
                        <li>ML components: Source Attribution, AQI Predictor, Action Engine</li>
                        <li>Frontend display: AQI Card, Charts, Alerts, Recommendations</li>
                        <li>Error handling and auto-refresh mechanisms</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const diagrams = {
            'confusion_matrix': `digraph ConfusionMatrix {
    rankdir=TB;
    node [shape=box, style=filled, fontname="Arial"];
    
    // Title
    labelloc="t";
    label="AirSense Guardian - AQI Prediction Confusion Matrix\n(RÂ² Score: 0.73, RMSE: 10.56, MAPE: 8.82%)";
    fontsize=16;
    fontname="Arial Bold";
    
    // Matrix structure
    subgraph cluster_matrix {
        label="Predicted AQI Categories";
        style=filled;
        color=lightgray;
        fontsize=12;
        
        // Header row
        Good [label="Good\n(0-50)", fillcolor=lightgreen, width=1.5, height=1.5];
        Moderate [label="Moderate\n(51-100)", fillcolor=yellow, width=1.5, height=1.5];
        UnhealthySensitive [label="Unhealthy\nSensitive\n(101-150)", fillcolor=orange, width=1.5, height=1.5];
        Unhealthy [label="Unhealthy\n(151-200)", fillcolor=red, width=1.5, height=1.5];
        VeryUnhealthy [label="Very\nUnhealthy\n(201-300)", fillcolor=purple, fillcolor=purple, width=1.5, height=1.5];
        Hazardous [label="Hazardous\n(301+)", fillcolor=maroon, fillcolor=maroon, width=1.5, height=1.5];
        
        // Actual rows
        subgraph cluster_actual {
            label="Actual AQI Categories";
            style=invis;
            
            ActualGood [label="Good\n(0-50)", fillcolor=lightgreen, width=1.5, height=1.5];
            ActualModerate [label="Moderate\n(51-100)", fillcolor=yellow, width=1.5, height=1.5];
            ActualUnhealthySensitive [label="Unhealthy\nSensitive\n(101-150)", fillcolor=orange, width=1.5, height=1.5];
            ActualUnhealthy [label="Unhealthy\n(151-200)", fillcolor=red, width=1.5, height=1.5];
            ActualVeryUnhealthy [label="Very\nUnhealthy\n(201-300)", fillcolor=purple, width=1.5, height=1.5];
            ActualHazardous [label="Hazardous\n(301+)", fillcolor=maroon, width=1.5, height=1.5];
        }
    }
    
    // Matrix values (simplified representation)
    subgraph cluster_values {
        label="Prediction Accuracy";
        style=filled;
        color=lightblue;
        fontsize=11;
        
        TP1 [label="TP: 85%\n(Good)", fillcolor=lightgreen];
        TP2 [label="TP: 78%\n(Moderate)", fillcolor=yellow];
        TP3 [label="TP: 72%\n(Unhealthy Sensitive)", fillcolor=orange];
        TP4 [label="TP: 75%\n(Unhealthy)", fillcolor=red];
        TP5 [label="TP: 68%\n(Very Unhealthy)", fillcolor=purple];
        TP6 [label="TP: 65%\n(Hazardous)", fillcolor=maroon];
        
        FP [label="False Positives: 8%", fillcolor=lightcoral];
        FN [label="False Negatives: 7%", fillcolor=lightcoral];
        Overall [label="Overall Accuracy: 73.3%\n(RÂ² Score)", fillcolor=lightblue, fontsize=12];
    }
    
    // Metrics box
    subgraph cluster_metrics {
        label="Model Performance Metrics";
        style=filled;
        color=lightyellow;
        fontsize=11;
        
        R2 [label="RÂ² Score: 0.733\n(73.3% variance explained)", fillcolor=lightgreen];
        RMSE [label="RMSE: 10.56 AQI points", fillcolor=lightblue];
        MAE [label="MAE: 8.39 AQI points", fillcolor=lightblue];
        MAPE [label="MAPE: 8.82%", fillcolor=lightblue];
    }
    
    // Layout
    {rank=same; Good; Moderate; UnhealthySensitive; Unhealthy; VeryUnhealthy; Hazardous}
    {rank=same; ActualGood; ActualModerate; ActualUnhealthySensitive; ActualUnhealthy; ActualVeryUnhealthy; ActualHazardous}
    
    // Connections showing prediction flow
    ActualGood -> TP1 [style=invis];
    ActualModerate -> TP2 [style=invis];
    ActualUnhealthySensitive -> TP3 [style=invis];
    ActualUnhealthy -> TP4 [style=invis];
    ActualVeryUnhealthy -> TP5 [style=invis];
    ActualHazardous -> TP6 [style=invis];
}

`,
            'deployment_pipeline': `digraph DeploymentPipeline {
    rankdir=LR;
    node [shape=box, style=rounded, fontname="Arial"];
    edge [fontname="Arial", fontsize=10];
    
    // Title
    labelloc="t";
    label="AirSense Guardian - Model Deployment Pipeline";
    fontsize=16;
    fontname="Arial Bold";
    
    // Data Collection Stage
    subgraph cluster_data {
        label="1. Data Collection & Preparation";
        style=filled;
        color=lightblue;
        
        OpenAQ [label="OpenAQ API\n(AQI Data)", fillcolor=lightcyan, shape=ellipse];
        WeatherAPI [label="OpenWeatherMap\n(Weather Data)", fillcolor=lightcyan, shape=ellipse];
        DataCollector [label="Data Collector\n(data_collector.py)", fillcolor=lightgreen];
        DataStorage [label="CSV Storage\n(aqi_training_data.csv)", fillcolor=lightyellow];
        
        OpenAQ -> DataCollector;
        WeatherAPI -> DataCollector;
        DataCollector -> DataStorage;
    }
    
    // Training Stage
    subgraph cluster_training {
        label="2. Model Training";
        style=filled;
        color=lightgreen;
        
        FeatureEng [label="Feature Engineering\n(Lags, Rolling Means,\nTime Features)", fillcolor=lightgreen];
        TrainSplit [label="Train/Val/Test Split\n(70/15/15)", fillcolor=lightgreen];
        HyperTune [label="Hyperparameter Tuning\n(GridSearchCV)", fillcolor=lightgreen];
        ModelTrain [label="Random Forest\nTraining", fillcolor=lightgreen];
        ModelEval [label="Model Evaluation\n(RÂ², RMSE, MAE)", fillcolor=lightgreen];
        
        DataStorage -> FeatureEng;
        FeatureEng -> TrainSplit;
        TrainSplit -> HyperTune;
        HyperTune -> ModelTrain;
        ModelTrain -> ModelEval;
    }
    
    // Model Storage
    subgraph cluster_storage {
        label="3. Model Persistence";
        style=filled;
        color=lightyellow;
        
        ModelSave [label="Save Model\n(aqi_model.pkl)", fillcolor=lightyellow];
        MetadataSave [label="Save Metadata\n(model_metadata.json)", fillcolor=lightyellow];
        
        ModelEval -> ModelSave;
        ModelEval -> MetadataSave;
    }
    
    // Deployment Stage
    subgraph cluster_deploy {
        label="4. Model Deployment";
        style=filled;
        color=lightcoral;
        
        ModelLoad [label="Load Model\n(AQIPredictor)", fillcolor=lightcoral];
        FlaskAPI [label="Flask API\n(app.py)", fillcolor=lightcoral];
        Endpoints [label="API Endpoints\n/current, /predict, /alerts", fillcolor=lightcoral];
        
        ModelSave -> ModelLoad;
        MetadataSave -> ModelLoad;
        ModelLoad -> FlaskAPI;
        FlaskAPI -> Endpoints;
    }
    
    // Production Stage
    subgraph cluster_prod {
        label="5. Production";
        style=filled;
        color=lightpink;
        
        Frontend [label="React Frontend", fillcolor=lightpink];
        UserRequest [label="User Request\n(Lat/Lon)", fillcolor=lightpink];
        RealTimeData [label="Real-time Data\nFetch", fillcolor=lightpink];
        Prediction [label="AQI Prediction\n(Next 3-6 hours)", fillcolor=lightpink];
        Response [label="JSON Response\n(AQI, Sources, Actions)", fillcolor=lightpink];
        
        Endpoints -> Frontend;
        Frontend -> UserRequest;
        UserRequest -> RealTimeData;
        RealTimeData -> Prediction;
        Prediction -> Response;
        Response -> Frontend;
    }
    
    // Monitoring Stage
    subgraph cluster_monitor {
        label="6. Monitoring & Updates";
        style=filled;
        color=lavender;
        
        Performance [label="Performance\nMonitoring", fillcolor=lavender];
        Retrain [label="Periodic\nRetraining", fillcolor=lavender];
        ModelUpdate [label="Model Update\n(Version Control)", fillcolor=lavender];
        
        Response -> Performance;
        Performance -> Retrain [label="If accuracy drops"];
        Retrain -> ModelUpdate;
        ModelUpdate -> ModelLoad [style=dashed, color=blue];
    }
    
    // Styling
    {rank=same; DataCollector; FeatureEng; ModelSave; ModelLoad; Frontend; Performance}
}

`,
            'system_flowchart': `digraph SystemFlowchart {
    rankdir=TB;
    node [shape=box, style=rounded, fontname="Arial"];
    edge [fontname="Arial", fontsize=10];
    
    // Title
    labelloc="t";
    label="AirSense Guardian - System Flowchart";
    fontsize=16;
    fontname="Arial Bold";
    
    // Start
    Start [label="User Opens\nApplication", fillcolor=lightgreen, shape=ellipse];
    
    // Frontend Initialization
    FrontendInit [label="React Frontend\nLoads", fillcolor=lightblue];
    DefaultLocation [label="Default Location:\nDelhi (28.6139, 77.2090)", fillcolor=lightblue];
    
    // User Input
    UserInput [label="User Input\n(Latitude, Longitude)", fillcolor=lightyellow, shape=diamond];
    
    // API Request
    APIRequest [label="API Request to\nFlask Backend\n(/api/aqi/current)", fillcolor=lightcoral];
    
    // Data Fetching
    subgraph cluster_data_fetch {
        label="Data Fetching";
        style=filled;
        color=lightcyan;
        
        FetchAQI [label="Fetch AQI Data\n(OpenAQ API)", fillcolor=lightcyan];
        FetchWeather [label="Fetch Weather Data\n(OpenWeatherMap)", fillcolor=lightcyan];
        EstimateTraffic [label="Estimate Traffic Density\n(Time-based)", fillcolor=lightcyan];
    }
    
    // Model Processing
    subgraph cluster_models {
        label="ML Models Processing";
        style=filled;
        color=lightgreen;
        
        SourceAttr [label="Source Attribution\n(Traffic, Industry,\nOpen Burning, Other)", fillcolor=lightgreen];
        Predictor [label="AQI Predictor\n(Random Forest)\nPredict Next 3-6 Hours", fillcolor=lightgreen];
        ActionEngine [label="Action Engine\nGenerate Recommendations\nwith Impact Estimates", fillcolor=lightgreen];
    }
    
    // Alert Generation
    AlertCheck [label="Check AQI Levels\nGenerate Alerts", fillcolor=orange, shape=diamond];
    
    // Response Assembly
    ResponseAssembly [label="Assemble JSON Response\n(AQI, Weather, Sources,\nPredictions, Actions, Alerts)", fillcolor=lightpink];
    
    // Frontend Display
    subgraph cluster_display {
        label="Frontend Display";
        style=filled;
        color=lavender;
        
        AQICard [label="AQI Card\n(Current AQI, Pollutants)", fillcolor=lavender];
        SourceViz [label="Source Attribution\nVisualization", fillcolor=lavender];
        PredictionsChart [label="Predictions Chart\n(Interactive Line Chart)", fillcolor=lavender];
        ActionCards [label="Action Cards\n(Recommendations)", fillcolor=lavender];
        AlertsPanel [label="Alerts Panel\n(Real-time Warnings)", fillcolor=lavender];
    }
    
    // User Actions
    UserActions [label="User Actions:\n- Change Location\n- View Details\n- Refresh Data", fillcolor=lightyellow, shape=diamond];
    
    // Refresh Loop
    Refresh [label="Auto-refresh\nEvery 5 minutes", fillcolor=lightblue];
    
    // Error Handling
    ErrorHandling [label="Error Handling\nFallback to Mock Data", fillcolor=red, shape=diamond];
    
    // Flow connections
    Start -> FrontendInit;
    FrontendInit -> DefaultLocation;
    DefaultLocation -> UserInput;
    UserInput -> APIRequest [label="Submit"];
    
    APIRequest -> FetchAQI;
    APIRequest -> FetchWeather;
    APIRequest -> EstimateTraffic;
    
    FetchAQI -> SourceAttr;
    FetchWeather -> SourceAttr;
    EstimateTraffic -> SourceAttr;
    
    FetchAQI -> Predictor;
    FetchWeather -> Predictor;
    EstimateTraffic -> Predictor;
    
    SourceAttr -> ActionEngine;
    Predictor -> ActionEngine;
    
    ActionEngine -> AlertCheck;
    AlertCheck -> ResponseAssembly;
    
    ResponseAssembly -> AQICard;
    ResponseAssembly -> SourceViz;
    ResponseAssembly -> PredictionsChart;
    ResponseAssembly -> ActionCards;
    ResponseAssembly -> AlertsPanel;
    
    AQICard -> UserActions;
    SourceViz -> UserActions;
    PredictionsChart -> UserActions;
    ActionCards -> UserActions;
    AlertsPanel -> UserActions;
    
    UserActions -> APIRequest [label="New Request"];
    UserActions -> Refresh [label="Auto"];
    Refresh -> APIRequest;
    
    // Error paths
    FetchAQI -> ErrorHandling [label="API Error", style=dashed, color=red];
    FetchWeather -> ErrorHandling [label="API Error", style=dashed, color=red];
    ErrorHandling -> ResponseAssembly [label="Use Mock Data", style=dashed, color=red];
    
    // Styling
    {rank=same; FetchAQI; FetchWeather; EstimateTraffic}
    {rank=same; SourceAttr; Predictor; ActionEngine}
    {rank=same; AQICard; SourceViz; PredictionsChart; ActionCards; AlertsPanel}
}

`
        };

        function showTab(index) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`tab-${index}`).style.display = 'block';
            event.target.classList.add('active');
            
            // Render diagram if not already rendered
            renderDiagram(index);
        }

        function renderDiagram(index) {
            const diagramNames = ['confusion_matrix', 'deployment_pipeline', 'system_flowchart'];
            const diagramName = diagramNames[index];
            const container = document.getElementById(`diagram-${index}`);
            
            if (!diagrams[diagramName]) {
                container.innerHTML = '<div class="error">Diagram content not found</div>';
                return;
            }
            
            try {
                const viz = new Viz();
                viz.renderSVGElement(diagrams[diagramName])
                    .then(function(element) {
                        container.innerHTML = '';
                        container.appendChild(element);
                    })
                    .catch(function(error) {
                        container.innerHTML = '<div class="error">Error rendering diagram. Please check console.</div>';
                        console.error('Error:', error);
                    });
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading Viz.js. Please check internet connection.</div>';
                console.error('Error:', error);
            }
        }

        // Render first diagram on load
        window.addEventListener('load', function() {
            renderDiagram(0);
        });
    </script>
</body>
</html>