digraph DeploymentPipeline {
    rankdir=LR;
    node [shape=box, style=rounded, fontname="Arial"];
    edge [fontname="Arial", fontsize=10];
    
    // Title
    labelloc="t";
    label="AirSense Guardian - Model Deployment Pipeline";
    fontsize=16;
    fontname="Arial Bold";
    
    // Data Collection Stage
    subgraph cluster_data {
        label="1. Data Collection & Preparation";
        style=filled;
        color=lightblue;
        
        OpenAQ [label="OpenAQ API\n(AQI Data)", fillcolor=lightcyan, shape=ellipse];
        WeatherAPI [label="OpenWeatherMap\n(Weather Data)", fillcolor=lightcyan, shape=ellipse];
        DataCollector [label="Data Collector\n(data_collector.py)", fillcolor=lightgreen];
        DataStorage [label="CSV Storage\n(aqi_training_data.csv)", fillcolor=lightyellow];
        
        OpenAQ -> DataCollector;
        WeatherAPI -> DataCollector;
        DataCollector -> DataStorage;
    }
    
    // Training Stage
    subgraph cluster_training {
        label="2. Model Training";
        style=filled;
        color=lightgreen;
        
        FeatureEng [label="Feature Engineering\n(Lags, Rolling Means,\nTime Features)", fillcolor=lightgreen];
        TrainSplit [label="Train/Val/Test Split\n(70/15/15)", fillcolor=lightgreen];
        HyperTune [label="Hyperparameter Tuning\n(GridSearchCV)", fillcolor=lightgreen];
        ModelTrain [label="Random Forest\nTraining", fillcolor=lightgreen];
        ModelEval [label="Model Evaluation\n(RÂ², RMSE, MAE)", fillcolor=lightgreen];
        
        DataStorage -> FeatureEng;
        FeatureEng -> TrainSplit;
        TrainSplit -> HyperTune;
        HyperTune -> ModelTrain;
        ModelTrain -> ModelEval;
    }
    
    // Model Storage
    subgraph cluster_storage {
        label="3. Model Persistence";
        style=filled;
        color=lightyellow;
        
        ModelSave [label="Save Model\n(aqi_model.pkl)", fillcolor=lightyellow];
        MetadataSave [label="Save Metadata\n(model_metadata.json)", fillcolor=lightyellow];
        
        ModelEval -> ModelSave;
        ModelEval -> MetadataSave;
    }
    
    // Deployment Stage
    subgraph cluster_deploy {
        label="4. Model Deployment";
        style=filled;
        color=lightcoral;
        
        ModelLoad [label="Load Model\n(AQIPredictor)", fillcolor=lightcoral];
        FlaskAPI [label="Flask API\n(app.py)", fillcolor=lightcoral];
        Endpoints [label="API Endpoints\n/current, /predict, /alerts", fillcolor=lightcoral];
        
        ModelSave -> ModelLoad;
        MetadataSave -> ModelLoad;
        ModelLoad -> FlaskAPI;
        FlaskAPI -> Endpoints;
    }
    
    // Production Stage
    subgraph cluster_prod {
        label="5. Production";
        style=filled;
        color=lightpink;
        
        Frontend [label="React Frontend", fillcolor=lightpink];
        UserRequest [label="User Request\n(Lat/Lon)", fillcolor=lightpink];
        RealTimeData [label="Real-time Data\nFetch", fillcolor=lightpink];
        Prediction [label="AQI Prediction\n(Next 3-6 hours)", fillcolor=lightpink];
        Response [label="JSON Response\n(AQI, Sources, Actions)", fillcolor=lightpink];
        
        Endpoints -> Frontend;
        Frontend -> UserRequest;
        UserRequest -> RealTimeData;
        RealTimeData -> Prediction;
        Prediction -> Response;
        Response -> Frontend;
    }
    
    // Monitoring Stage
    subgraph cluster_monitor {
        label="6. Monitoring & Updates";
        style=filled;
        color=lavender;
        
        Performance [label="Performance\nMonitoring", fillcolor=lavender];
        Retrain [label="Periodic\nRetraining", fillcolor=lavender];
        ModelUpdate [label="Model Update\n(Version Control)", fillcolor=lavender];
        
        Response -> Performance;
        Performance -> Retrain [label="If accuracy drops"];
        Retrain -> ModelUpdate;
        ModelUpdate -> ModelLoad [style=dashed, color=blue];
    }
    
    // Styling
    {rank=same; DataCollector; FeatureEng; ModelSave; ModelLoad; Frontend; Performance}
}

