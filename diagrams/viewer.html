<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirSense Guardian - Diagram Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/viz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/full.render.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .diagram-section {
            margin: 40px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .diagram-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            padding: 10px;
            background: #3498db;
            color: white;
            border-radius: 4px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            text-align: center;
        }
        .description {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        .description h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .description ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .description li {
            margin: 5px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            color: red;
            padding: 10px;
            background: #ffe6e6;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š AirSense Guardian - Diagram Viewer</h1>
        
        <div class="diagram-section">
            <div class="diagram-title">1. Confusion Matrix - AQI Prediction Accuracy</div>
            <div class="diagram-container" id="confusion-matrix">
                <div class="loading">Loading diagram...</div>
            </div>
            <div class="description">
                <h3>What this shows:</h3>
                <ul>
                    <li>AQI prediction accuracy by category (Good, Moderate, Unhealthy, etc.)</li>
                    <li>True Positive rates for each category</li>
                    <li>Model performance metrics: RÂ² Score: 0.733 (73.3% variance explained)</li>
                    <li>RMSE: 10.56 AQI points, MAE: 8.39, MAPE: 8.82%</li>
                    <li>Overall accuracy breakdown</li>
                </ul>
            </div>
        </div>

        <div class="diagram-section">
            <div class="diagram-title">2. Model Deployment Pipeline</div>
            <div class="diagram-container" id="deployment-pipeline">
                <div class="loading">Loading diagram...</div>
            </div>
            <div class="description">
                <h3>What this shows:</h3>
                <ul>
                    <li><strong>Stage 1:</strong> Data Collection (OpenAQ, OpenWeatherMap APIs)</li>
                    <li><strong>Stage 2:</strong> Model Training (Feature Engineering, Hyperparameter Tuning)</li>
                    <li><strong>Stage 3:</strong> Model Persistence (Save model and metadata)</li>
                    <li><strong>Stage 4:</strong> Model Deployment (Flask API with endpoints)</li>
                    <li><strong>Stage 5:</strong> Production (React Frontend integration)</li>
                    <li><strong>Stage 6:</strong> Monitoring & Updates (Performance tracking, retraining)</li>
                </ul>
            </div>
        </div>

        <div class="diagram-section">
            <div class="diagram-title">3. System Flowchart - Complete Architecture</div>
            <div class="diagram-container" id="system-flowchart">
                <div class="loading">Loading diagram...</div>
            </div>
            <div class="description">
                <h3>What this shows:</h3>
                <ul>
                    <li>User journey from frontend to backend</li>
                    <li>Data flow: API requests â†’ ML models â†’ responses</li>
                    <li>ML components: Source Attribution, Predictor, Action Engine</li>
                    <li>Frontend display components (AQI Card, Charts, Alerts)</li>
                    <li>Error handling and auto-refresh mechanisms</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Function to render diagram
        function renderDiagram(elementId, dotContent) {
            const element = document.getElementById(elementId);
            try {
                const viz = new Viz();
                viz.renderSVGElement(dotContent)
                    .then(function(element_svg) {
                        element.innerHTML = '';
                        element.appendChild(element_svg);
                    })
                    .catch(error => {
                        element.innerHTML = '<div class="error">Error rendering diagram. Please check the DOT file content.</div>';
                        console.error('Error:', error);
                    });
            } catch (error) {
                element.innerHTML = '<div class="error">Error loading Viz.js library. Please check your internet connection.</div>';
                console.error('Error:', error);
            }
        }

        // Load and render diagrams
        async function loadDiagrams() {
            try {
                // Load Confusion Matrix
                const response1 = await fetch('confusion_matrix.dot');
                if (response1.ok) {
                    const dot1 = await response1.text();
                    renderDiagram('confusion-matrix', dot1);
                } else {
                    document.getElementById('confusion-matrix').innerHTML = 
                        '<div class="error">Could not load confusion_matrix.dot. Please ensure the file exists.</div>';
                }

                // Load Deployment Pipeline
                const response2 = await fetch('deployment_pipeline.dot');
                if (response2.ok) {
                    const dot2 = await response2.text();
                    renderDiagram('deployment-pipeline', dot2);
                } else {
                    document.getElementById('deployment-pipeline').innerHTML = 
                        '<div class="error">Could not load deployment_pipeline.dot. Please ensure the file exists.</div>';
                }

                // Load System Flowchart
                const response3 = await fetch('system_flowchart.dot');
                if (response3.ok) {
                    const dot3 = await response3.text();
                    renderDiagram('system-flowchart', dot3);
                } else {
                    document.getElementById('system-flowchart').innerHTML = 
                        '<div class="error">Could not load system_flowchart.dot. Please ensure the file exists.</div>';
                }
            } catch (error) {
                console.error('Error loading diagrams:', error);
                document.querySelectorAll('.diagram-container').forEach(el => {
                    if (el.innerHTML.includes('Loading')) {
                        el.innerHTML = '<div class="error">Error loading diagrams. Please open this HTML file from a local web server or use the online viewer.</div>';
                    }
                });
            }
        }

        // Start loading when page loads
        window.addEventListener('load', loadDiagrams);
    </script>
</body>
</html>

